<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é«˜çŸ¥ã‚¯ã‚¨ã‚¹ãƒˆ - é«˜çŸ¥é™å®šç‰ˆ</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; background: #aad3df; } /* èƒŒæ™¯ã‚’æµ·ã®è‰²ã« */
        #map { height: 100vh; width: 100%; z-index: 1; }

        #ui-layer {
            position: absolute; top: 15px; left: 15px; z-index: 100;
            background: rgba(0, 0, 0, 0.85); color: #ffd700;
            padding: 15px; border: 2px solid #ffd700; border-radius: 8px;
            font-family: 'Hiragino Kaku Gothic ProN', sans-serif;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }

        #quiz-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 1000;
            display: flex; justify-content: center; align-items: center;
        }

        .quiz-content {
            background: #fffbe6; color: #333; padding: 30px;
            border: 6px double #8b4513; width: 85%; max-width: 400px;
            text-align: center; border-radius: 10px;
        }

        .option-btn {
            display: block; width: 100%; margin: 12px 0; padding: 15px;
            background: #2a5d9a; color: white; border: none; 
            cursor: pointer; border-radius: 8px; font-size: 1rem; font-weight: bold;
        }

        .hidden { display: none !important; }
        .leaflet-marker-icon { cursor: pointer; }
    </style>
</head>
<body>

    <div id="ui-layer">
        <h2 style="margin:0;">ğŸ—¡ï¸ é«˜çŸ¥ã‚¯ã‚¨ã‚¹ãƒˆ</h2>
        <p id="score" style="margin:5px 0 0 0; font-weight: bold;">ç²å¾—ã—ãŸç§˜å®: 0 / 20</p>
    </div>

    <div id="map"></div>

    <div id="quiz-modal" class="hidden">
        <div class="quiz-content">
            <h2 id="quiz-spot-name" style="color: #2a5d9a; margin-top: 0;"></h2>
            <p id="quiz-question" style="font-weight: bold; margin-bottom: 20px;"></p>
            <div id="quiz-options"></div>
            <button onclick="closeQuiz()" style="margin-top:20px; background:none; border:none; color:gray; text-decoration:underline;">é€ƒã’ã‚‹</button>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // --- 1. é«˜çŸ¥é™å®šã®è¨­å®š ---
        // é«˜çŸ¥çœŒã‚’å›²ã‚€å››è§’ã„å¢ƒç•Œç·š [å—è¥¿ã®åº§æ¨™, åŒ—æ±ã®åº§æ¨™]
        const kochiBounds = [
            [32.3, 132.0], // ä¸‹ãƒ»å·¦ï¼ˆè¶³æ‘ºã‚ˆã‚Šå¤–å´ï¼‰
            [34.2, 134.8]  // ä¸Šãƒ»å³ï¼ˆå®¤æˆ¸ã‚ˆã‚Šå¤–å´ï¼‰
        ];

        const map = L.map('map', {
            tap: true,
            zoomControl: false,
            // ã“ã“ã‹ã‚‰ã€Œé™å®šã€ã®ãŸã‚ã®è¨­å®š
            maxBounds: kochiBounds,       // ã“ã®ç¯„å›²å¤–ã¸ã¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä¸å¯
            maxBoundsViscosity: 1.0,     // ç¯„å›²å¤–ã«å‡ºã‚ˆã†ã¨ã—ãŸæ™‚ã®åç™ºåŠ›ï¼ˆ1.0ã§å®Œå…¨ã‚¬ãƒ¼ãƒ‰ï¼‰
            minZoom: 9,                  // å¼•ãã™ãã¦æ—¥æœ¬å…¨ä½“ãŒè¦‹ãˆã‚‹ã®ã‚’é˜²æ­¢
            maxZoom: 15                  // å¯„ã‚Šã™ãã¦è¿·å­ã«ãªã‚‹ã®ã‚’é˜²æ­¢
        }).setView([33.35, 133.4], 9);   // é«˜çŸ¥å…¨ä½“ãŒç¶ºéº—ã«å…¥ã‚‹åˆæœŸä½ç½®

        // åœ°å›³ã‚¿ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã‚‚é«˜çŸ¥ã®ç¯„å›²ã«åˆ¶é™
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap',
            bounds: kochiBounds
        }).addTo(map);

        let score = 0;

        // 2. ã‚¹ãƒãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ï¼ˆå…¨20ç®‡æ‰€ï¼‰
        const questSpots = [
            { name: "é«˜çŸ¥åŸ", pos: [33.5607, 133.5314], q: "é«˜çŸ¥åŸã«ã‚ã‚‹ã€è¿½æ‰‹é–€ã¨å¤©å®ˆã‚’ä¸€æšã®å†™çœŸã«åã‚ã‚‰ã‚Œã‚‹ã®ã¯å…¨å›½çš„ã«ã‚‚çã—ã„ï¼Ÿ", ops: ["ã¯ã„", "ã„ã„ãˆ"], ans: "ã¯ã„" },
            { name: "æ¡‚æµœ", pos: [33.4971, 133.5744], q: "æ¡‚æµœã®å‚æœ¬é¾é¦¬åƒãŒæ¯å¹´ã€Œé¾é¦¬ã«å¤§æ¥è¿‘ã€ã§ãã‚‹æ™‚æœŸã¯ï¼Ÿ", ops: ["æ˜¥ã¨ç§‹", "å¤ä¼‘ã¿", "ãŠæ­£æœˆ"], ans: "æ˜¥ã¨ç§‹" },
            { name: "ç‰§é‡æ¤ç‰©åœ’", pos: [33.5463, 133.5775], q: "ç‰§é‡å¯Œå¤ªéƒåšå£«ãŒå¥¥æ§˜ã®åå‰ã‹ã‚‰åä»˜ã‘ãŸæ¤ç‰©ã¯ï¼Ÿ", ops: ["ã‚¹ã‚¨ã‚³ã‚¶ã‚µ", "ãƒˆãƒŸã‚¿ãƒ­ã‚¦ã‚®ã‚¯", "ã‚³ã‚¦ãƒãƒ¦ãƒª"], ans: "ã‚¹ã‚¨ã‚³ã‚¶ã‚µ" },
            { name: "ã®ã„ã¡å‹•ç‰©å…¬åœ’", pos: [33.5621, 133.6934], q: "ã“ã®å‹•ç‰©åœ’ã§æœ‰åãªã€Œå‹•ã‹ãªã„é³¥ã€ã¯ï¼Ÿ", ops: ["ãƒã‚·ãƒ“ãƒ­ã‚³ã‚¦", "ãƒ•ãƒ©ãƒŸãƒ³ã‚´", "ãƒšãƒ³ã‚®ãƒ³"], ans: "ãƒã‚·ãƒ“ãƒ­ã‚³ã‚¦" },
            { name: "å®¤æˆ¸å²¬", pos: [33.2472, 134.1751], q: "å¼˜æ³•å¤§å¸«ï¼ˆç©ºæµ·ï¼‰ãŒä¿®è¡Œã—ãŸã¨è¨€ã‚ã‚Œã‚‹æ´çªŸã¯ï¼Ÿ", ops: ["å¾¡å¨äººçªŸï¼ˆã¿ãã‚ã©ï¼‰", "é¾æ²³æ´", "é’ã®æ´çªŸ"], ans: "å¾¡å¨äººçªŸï¼ˆã¿ãã‚ã©ï¼‰" },
            { name: "å®‰èŠ¸ãƒ»é‡è‰¯æ™‚è¨ˆ", pos: [33.5135, 133.9111], q: "é‡è‰¯æ™‚è¨ˆã¯ã€æ˜”ã®äººãŒä½•ã®ãŸã‚ã«ä½œã£ãŸï¼Ÿ", ops: ["è¾²ä½œæ¥­ã®æ™‚é–“ã‚’çŸ¥ã‚‹ãŸã‚", "è¦³å…‰ã®ãŸã‚", "å ã„ã®ãŸã‚"], ans: "è¾²ä½œæ¥­ã®æ™‚é–“ã‚’çŸ¥ã‚‹ãŸã‚" },
            { name: "åŒ—å·æ‘ãƒ»ãƒ¢ãƒã®åº­", pos: [33.5619, 134.0487], q: "ãƒ•ãƒ©ãƒ³ã‚¹ä»¥å¤–ã§å”¯ä¸€ã€Œãƒ¢ãƒã®åº­ã€ã¨åä¹—ã‚Œã‚‹å ´æ‰€ã§ã‚ã‚‹ï¼Ÿ", ops: ["æœ¬å½“", "å˜˜"], ans: "æœ¬å½“" },
            { name: "é¦¬è·¯æ‘", pos: [33.6672, 134.0045], q: "é¦¬è·¯æ‘ã§æœ€ã‚‚æœ‰åãªç‰¹ç”£å“ã¯ï¼Ÿ", ops: ["ã‚†ãš", "ã¿ã‹ã‚“", "ãƒªãƒ³ã‚´"], ans: "ã‚†ãš" },
            { name: "é¾æ²³æ´", pos: [33.6033, 133.7436], q: "æ´å†…ã«ã‚ã‚‹å¼¥ç”Ÿæ™‚ä»£ã®åœŸå™¨ãŒé¾ä¹³çŸ³åŒ–ã—ãŸã‚‚ã®ã¯ï¼Ÿ", ops: ["ç¥ã®å£º", "çŸ³ã®çš¿", "é­”æ³•ã®æ–"], ans: "ç¥ã®å£º" },
            { name: "è¶³æ‘ºå²¬", pos: [32.7231, 133.0185], q: "å››å›½æœ€å—ç«¯ã®å²¬ã¨ã„ãˆã°ï¼Ÿ", ops: ["è¶³æ‘ºå²¬", "å®¤æˆ¸å²¬", "æ¡‚æµœ"], ans: "è¶³æ‘ºå²¬" },
            { name: "ä½ç”°æ²ˆä¸‹æ©‹", pos: [32.9984, 132.9333], q: "å››ä¸‡åå·ã®æ²ˆä¸‹æ©‹ã«ã€Œæ¬„å¹²ï¼ˆæ‰‹ã™ã‚Šï¼‰ã€ãŒãªã„ç†ç”±ã¯ï¼Ÿ", ops: ["å¢—æ°´æ™‚ã«æµã•ã‚Œãªã„ãŸã‚", "æ™¯è‰²ã‚’è‰¯ãã™ã‚‹ãŸã‚", "å®‰ãä½œã‚‹ãŸã‚"], ans: "å¢—æ°´æ™‚ã«æµã•ã‚Œãªã„ãŸã‚" },
            { name: "æŸå³¶", pos: [32.7681, 132.6311], q: "èˆ¹ãŒå®™ã«æµ®ã„ã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ãˆã‚‹ã»ã©é€æ˜åº¦ãŒé«˜ã„å³¶ã¯ï¼Ÿ", ops: ["æŸå³¶", "æ²–ã®å³¶", "éµœæ¥å³¶"], ans: "æŸå³¶" },
            { name: "å¤©ç‹—é«˜åŸ", pos: [33.4756, 132.9856], q: "é«˜çŸ¥çœŒã¨æ„›åª›çœŒã®çœŒå¢ƒã«åºƒãŒã‚‹ã‚«ãƒ«ã‚¹ãƒˆå°åœ°ã®åå‰ã¯ï¼Ÿ", ops: ["å››å›½ã‚«ãƒ«ã‚¹ãƒˆ", "ç§‹å‰å°", "è”µç‹"], ans: "å››å›½ã‚«ãƒ«ã‚¹ãƒˆ" },
            { name: "é“ã®é§… ã‚ãã‚Šçªªå·", pos: [33.2166, 133.1362], q: "ã“ã“ã§äººæ°—ã®ãƒ–ãƒ©ãƒ³ãƒ‰è±šã®åå‰ã¯ï¼Ÿ", ops: ["å››ä¸‡åãƒãƒ¼ã‚¯", "åœŸä½ã‚¸ãƒ­ãƒ¼", "ã‚ã‹ç‰›"], ans: "å››ä¸‡åãƒãƒ¼ã‚¯" },
            { name: "ç ‚æµœç¾è¡“é¤¨", pos: [33.0306, 133.0561], q: "é»’æ½®ç”ºã«ã‚ã‚‹ã€4kmã®ç ‚æµœã‚’ãã®ã¾ã¾é¤¨å†…ã«è¦‹ç«‹ã¦ãŸç¾è¡“é¤¨ã¯ï¼Ÿ", ops: ["å…¥é‡æµ·å²¸", "æ¡‚æµœ", "å¤§å²ã®æµœ"], ans: "å…¥é‡æµ·å²¸" },
            { name: "æ—©æ˜æµ¦ãƒ€ãƒ ", pos: [33.7547, 133.5539], q: "ã€Œå››å›½ã®æ°´ãŒã‚ã€ã¨å‘¼ã°ã‚Œã‚‹å·¨å¤§ãªãƒ€ãƒ ã¯ï¼Ÿ", ops: ["æ—©æ˜æµ¦ãƒ€ãƒ ", "æ°¸ç€¬ãƒ€ãƒ ", "éŒäº•ç”°ãƒ€ãƒ "], ans: "æ—©æ˜æµ¦ãƒ€ãƒ " },
            { name: "ã«ã“æ·µ", pos: [33.7583, 133.3106], q: "ä»æ·€ãƒ–ãƒ«ãƒ¼ãŒæœ€ã‚‚ç¾ã—ãè¦‹ãˆã‚‹ã¨è¨€ã‚ã‚Œã‚‹ã‚¹ãƒãƒƒãƒˆã¯ï¼Ÿ", ops: ["ã«ã“æ·µ", "å®‰å±…æ¸“è°·", "ä¸­æ´¥æ¸“è°·"], ans: "ã«ã“æ·µ" },
            { name: "æª®åŸç”ºï¼ˆé›²ã®ä¸Šã®å›³æ›¸é¤¨ï¼‰", pos: [33.4795, 132.9156], q: "ã“ã®å›³æ›¸é¤¨ã‚’è¨­è¨ˆã—ãŸæœ‰åãªå»ºç¯‰å®¶ã¯ï¼Ÿ", ops: ["éšˆç ”å¾", "å®‰è—¤å¿ é›„", "ä¸¹ä¸‹å¥ä¸‰"], ans: "éšˆç ”å¾" },
            { name: "æµ·æ´‹å ‚ãƒ›ãƒ“ãƒ¼é¤¨", pos: [33.2045, 132.8805], q: "å››ä¸‡åç”ºã«ã‚ã‚‹ãƒ•ã‚£ã‚®ãƒ¥ã‚¢ã®æ®¿å ‚ã€‚å…ƒã€…ã¯ä½•ã®å»ºç‰©ã ã£ãŸï¼Ÿ", ops: ["å°å­¦æ ¡ã®ä½“è‚²é¤¨", "ãŠå¯º", "é§…èˆ"], ans: "å°å­¦æ ¡ã®ä½“è‚²é¤¨" },
            { name: "ä¸­æ´¥æ¸“è°·", pos: [33.5656, 133.1025], q: "å·¨å¤§ãªã€Œä¸ƒç¦ç¥åƒã€ãŒç‚¹åœ¨ã™ã‚‹æ¸“è°·ã¯ï¼Ÿ", ops: ["ä¸­æ´¥æ¸“è°·", "å®‰å±…æ¸“è°·", "åˆ¥åºœæ¸“è°·"], ans: "ä¸­æ´¥æ¸“è°·" }
        ];

        // 3. ãƒãƒ¼ã‚«ãƒ¼ã®è¨­ç½®
        questSpots.forEach((spot, index) => {
            const marker = L.marker(spot.pos).addTo(map);
            marker.on('click', (e) => {
                L.DomEvent.stopPropagation(e);
                openQuiz(index);
            });
        });

        function openQuiz(index) {
            const spot = questSpots[index];
            document.getElementById('quiz-spot-name').innerText = spot.name;
            document.getElementById('quiz-question').innerText = spot.q;
            const optionsDiv = document.getElementById('quiz-options');
            optionsDiv.innerHTML = ""; 
            spot.ops.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = "option-btn";
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(opt, spot.ans, index);
                optionsDiv.appendChild(btn);
            });
            document.getElementById('quiz-modal').classList.remove('hidden');
        }

        function checkAnswer(userAns, correctAns, index) {
            if (userAns === correctAns) {
                alert("æ­£è§£ï¼ç§˜å®ã‚²ãƒƒãƒˆãœã‚ˆï¼");
                score++;
                document.getElementById('score').innerText = `ç²å¾—ã—ãŸç§˜å®: ${score} / 20`;
            } else {
                alert("ãƒã‚ºãƒ¬ï¼å‡ºç›´ã—ã¡ã‚„ï¼");
            }
            closeQuiz();
        }

        function closeQuiz() {
            document.getElementById('quiz-modal').classList.add('hidden');
        }
    </script>
</body>
</html>
